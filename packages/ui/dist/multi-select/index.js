import {useState,useMemo,useCallback}from'react';import {Listbox,Label,ListboxButton,ListboxOptions,ListboxOption}from'@headlessui/react';import {tv,cx}from'tailwind-variants';import {jsxs,jsx,Fragment}from'react/jsx-runtime';function o(...e){return cx(...e)||""}function _(e){return jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",...e,children:jsx("path",{d:"M18 6 6 18M6 6l12 12"})})}function X(e){return jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",...e,children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})})}function q(e){return jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:e.strokeWidth??1.5,stroke:"currentColor",...e,children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 8.25l-7.5 7.5-7.5-7.5"})})}var J=(e,a)=>{let s=a!==void 0,[n,i]=useState(e);return [s?a:n,f=>{s||i(f);}]},Y={top:"top",right:"right",bottom:"bottom",left:"left","top-start":"top start","top-end":"top end","bottom-start":"bottom start","bottom-end":"bottom end","right-start":"right start","right-end":"right end","left-start":"left start","left-end":"left end"};function Z(e){(!["ArrowUp","ArrowDown","Enter","Home","End","Escape"].includes(e.key)||e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)&&e.stopPropagation();}function ee(e,a,s,n){return useMemo(()=>n?e:e.filter(i=>{let c=i[s];return c?String(c).toLowerCase().includes(a.toLowerCase()):false}),[a,e,n,s])}var Xe=tv({base:"text-red",variants:{size:{sm:"text-[11px] mt-0.5",md:"text-[13px] mt-0.5",lg:"text-[13px] mt-1"}}});function M({as:e="div",error:a,size:s,className:n}){let i=e;return a?jsx(i,{role:"alert","aria-live":"polite",className:Xe({size:s,className:n}),children:a}):null}M.displayName="FieldErrorText";var te={normal:"font-normal",medium:"font-medium",semibold:"font-semibold",bold:"font-bold"};var L={weight:te,size:{sm:"text-xs mb-1",md:"text-sm mb-1.5",lg:"text-sm mb-1.5"}};var Je=tv({variants:{size:{sm:"text-[11px] mt-0.5",md:"text-[13px] mt-0.5",lg:"text-[13px] mt-1"}}});function O({size:e,as:a="div",children:s,className:n}){let i=a;return s?jsx(i,{className:Je({size:e,className:n}),children:s}):null}O.displayName="FieldHelperText";var et=tv({base:"somaui-input-clear-btn input-clear-btn inline-flex shrink-0 transform items-center justify-center rounded-full bg-muted/70 backdrop-blur text-foreground/90 transition-all duration-200 ease-in-out hover:bg-primary hover:text-primary-foreground",variants:{size:{sm:"h-3.5 w-3.5",md:"h-4 w-4",lg:"h-4 w-4"},hasSuffix:{true:""}},compoundVariants:[{hasSuffix:true,size:"sm",class:"me-1.5"},{hasSuffix:true,size:"md",class:"me-2"},{hasSuffix:true,size:"lg",class:"me-2.5"}]});function z({as:e,size:a,onClick:s,hasSuffix:n,className:i}){return jsx(e||"button",{type:"button",onClick:s,"aria-label":"Clear input",className:et({size:a,hasSuffix:n,className:i}),children:jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-auto","aria-hidden":"true",children:jsx("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})})})}z.displayName="FieldClearButton";function oe(e){return jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,...e,children:jsx("path",{d:"M20 6 9 17l-5-5"})})}var E={base:"z-[999] border-[length:var(--border-width)] border-border bg-background !p-1.5 focus-visible:outline-none dark:bg-muted/80 dark:backdrop-blur-sm rounded-[var(--border-radius)]",shadow:"shadow-[0px_8px_24px_rgba(149,157,165,0.2)]"};var u={base:`${E.base} overflow-auto w-[var(--button-width)] !outline-none !ring-0 m-0 [&>li]:!m-0 [scrollbar-width:thin] [scrollbar-color:rgba(0,0,0,0.2)_rgba(0,0,0,0)] [-ms-overflow-style:none] [&::-webkit-scrollbar-track]:shadow-none [&::-webkit-scrollbar-track]:bg-transparent [&::-webkit-scrollbar]:bg-transparent [&::-webkit-scrollbar]:w-[5px] [&::-webkit-scrollbar-thumb]:bg-muted [&::-webkit-scrollbar-thumb]:rounded-lg data-[open]:opacity-100 data-[leave]:data-[closed]:opacity-100`,shadow:E.shadow,item:{size:{sm:"text-xs",md:"text-sm",lg:"text-base"}},inPortal:"[--anchor-max-height:256px]",notInPortal:"absolute z-10 h-[256px] start-0 top-full mt-1.5"},b={base:"relative mb-2 block group [&.sticky]:mb-0",inputBase:"px-10 placeholder:text-muted-foreground",prefix:"absolute z-10 start-1 top-5 group-[.sticky]:top-7 inline-block -translate-y-1/2 whitespace-nowrap leading-normal text-muted-foreground",suffix:"absolute z-10 end-1 top-5 group-[.sticky]:top-7 inline-block -translate-y-1/2 whitespace-nowrap leading-normal text-muted-foreground",stickySearch:"sticky top-0 z-10 bg-background pt-2 -translate-y-2"};var ae=tv({base:"flex group items-center peer border-[length:var(--border-width)] hover:border-primary w-full transition duration-200 hover:ring-primary focus:border-primary focus:ring-[0.8px] focus:ring-primary rounded-[var(--border-radius)]",variants:{variant:{text:"border-transparent ring-transparent bg-transparent",outline:"border-border ring-border bg-transparent"},size:{sm:"px-2 py-1 text-xs min-h-8",md:"px-3 py-2 text-sm min-h-10",lg:"px-4 py-2 text-base min-h-12"},disabled:{true:"!bg-muted/70 backdrop-blur cursor-not-allowed !border-muted text-muted-foreground placeholder:text-muted-foreground !ring-muted"},error:{true:"!border-red hover:!border-red focus:!border-red !ring-red"},hasPrefix:{true:""},hasSuffix:{true:""}},compoundVariants:[{hasPrefix:true,class:"ps-2.5"},{hasSuffix:true,class:"pe-2.5"}],defaultVariants:{variant:"outline",size:"md"}}),se={base:"peer checked:bg-none focus:ring-offset-background transition duration-200 ease-in-out size-5 rounded bg-transparent border border-border ring-border focus:ring-border checked:!bg-primary checked:!border-primary hover:enabled:border-primary",icon:"peer-checked:opacity-100 absolute opacity-0 text-primary-foreground size-4 start-0.5 top-0.5"};function pt({gap:e=6,modal:a=false,value:s,error:n,label:i,options:c,onClear:N,onChange:f,disabled:h,clearable:ie,className:le,autoFocus:pe,helperText:R,size:d="md",searchProps:ce,stickySearch:de,displayValue:B,prefix:C=null,labelClassName:me,onSearchChange:ue,errorClassName:be,inPortal:y=true,selectClassName:fe,helperClassName:ge,prefixClassName:xe,suffixClassName:he,searchClassName:ye,optionClassName:ve,defaultValue:we=[],dropdownClassName:Se,searchable:ke=false,variant:H="outline",searchSuffix:F=null,searchType:Ne="text",selectedItemClassName:Ce,getOptionDisplayValue:A,getOptionValue:P,searchByKey:Pe="label",optionCheckBox:Te=true,searchPrefixClassName:Me,searchSuffixClassName:Le,labelWeight:Oe="medium",searchDisabled:G=false,searchReadOnly:Ve=false,selectedOptionClassName:ze,searchContainerClassName:Ee,selectContainerClassName:Ie,placeholder:Re="Select...",hideSelectedOptions:Be=false,placement:He="bottom-start",getOptionValueKey:T="value",disableDefaultFilter:Fe,searchPlaceHolder:Ae="Search...",suffix:v=jsx(q,{strokeWidth:"2",className:"size-4"}),searchPrefix:W=jsx(X,{strokeWidth:"2",className:"size-4"}),...Ge}){let[w,g]=J(we,s),[K,$]=useState(""),S=useMemo(()=>w??[],[w]),k=S.length===0,We=ee(c,K,Pe,Fe),Ke=useCallback(t=>{t?.stopPropagation(),g([]),$(""),N?.(t);},[N,g]),D=useCallback(t=>{let m=S.filter(l=>l!==t);g(m),f?.(m);},[S,g,f]),$e=useCallback(t=>P?P(t):t[T],[P,T]);return jsxs("div",{className:o("somaui-multi-select-root","grid w-full grid-cols-1",le),children:[jsx(Listbox,{multiple:true,disabled:h,value:w,defaultValue:w,onChange:t=>{f?.(t),g(t);},...Ge,children:jsxs("div",{className:"contents",children:[i&&jsx(Label,{className:o("somaui-multi-select-label","block",L.size[d],L.weight[Oe],h&&"text-muted-foreground",me),children:i}),jsxs("div",{className:o(!y&&"relative"),children:[jsxs(ListboxButton,{className:ae({variant:H,size:d,disabled:h,error:!!(n&&k),hasPrefix:!!C,hasSuffix:!!v,className:fe}),autoFocus:pe,children:[C&&jsx("span",{className:o("somaui-multi-select-prefix","block leading-normal whitespace-nowrap",xe),children:C}),B?B(S,c,D):jsx("span",{className:o("somaui-multi-select-value","flex w-full flex-wrap items-center gap-2 truncate text-start",k&&"text-muted-foreground",Ie),children:k?Re:jsx(Fragment,{children:s?.map((t,m)=>{let l=c.find(x=>x[T]===t);return jsxs("span",{className:o("item-center border-border flex gap-1 overflow-hidden rounded-md border text-xs",Ce),children:[jsx("span",{className:"py-1 ps-2",children:l?.label}),jsx("span",{className:"hover:bg-muted px-1 py-1",onClick:x=>{x.stopPropagation(),D(t);},children:jsx(_,{strokeWidth:"2",className:"size-4 cursor-pointer"})})]},m)})})}),ie&&!k&&!h&&jsx(z,{as:"span",size:d,onClick:Ke,hasSuffix:!!v}),v&&jsx("span",{className:o("somaui-multi-select-suffix","leading-normal whitespace-nowrap transition-transform duration-200 group-data-open:rotate-180",he),children:v})]}),jsxs(ListboxOptions,{modal:a,portal:y,...y&&{anchor:{to:Y[He],gap:e}},className:o("somaui-multi-select-options",u.base,u.shadow,y?u.inPortal:u.notInPortal,Se),children:[ke&&jsxs("div",{className:o(b.base,de&&b.stickySearch,Ee),children:[W&&jsx("span",{className:o("somaui-multi-select-prefix",b.prefix,Me),children:W}),jsx("input",{type:Ne,spellCheck:false,value:K,disabled:G,readOnly:Ve,placeholder:Ae,onChange:t=>{$(t.target.value),ue?.(t.target.value);},onKeyDown:t=>Z(t),className:ae({variant:H,size:d,disabled:G,className:o(b.inputBase,ye)}),...ce}),F&&jsx("span",{className:o("somaui-multi-select-suffix",b.suffix,Le),children:F})]}),We.map((t,m)=>jsx(ListboxOption,{value:$e(t),...t?.disabled&&{disabled:t?.disabled},className:({focus:l,selected:x})=>o("somaui-multi-select-option","flex w-full items-center px-3 py-1.5",l&&"bg-muted/70","rounded-[calc(var(--border-radius)/2)]",d&&u.item.size[d],!t?.disabled&&"cursor-pointer",x&&Be&&"hidden!",ve),children:({selected:l})=>jsx(Fragment,{children:A?A(t,l):jsxs("div",{className:o("flex items-center gap-2",l?"font-medium":"text-foreground",ze),children:[Te&&jsxs("span",{className:"relative leading-none",children:[jsx("input",{type:"checkbox",readOnly:true,checked:l,className:o("somaui-checkbox-input",se.base)}),jsx(oe,{className:o("somaui-checkbox-icon",se.icon)})]}),t.label]})})},m))]})]})]})}),!n&&R&&jsx(O,{size:d,className:ge,children:R}),n&&jsx(M,{size:d,error:n,className:be})]})}
export{pt as MultiSelect};