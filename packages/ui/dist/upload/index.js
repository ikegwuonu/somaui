import {useCallback,useRef,useState,useImperativeHandle,useEffect,useMemo}from'react';import {tv,cx}from'tailwind-variants';import {jsxs,jsx}from'react/jsx-runtime';function l(...o){return cx(...o)||""}var he=tv({base:"text-red",variants:{size:{sm:"text-[11px] mt-0.5",md:"text-[13px] mt-0.5",lg:"text-[13px] mt-1"}}});function R({as:o="div",error:s,size:n,className:t}){let u=o;return s?jsx(u,{role:"alert","aria-live":"polite",className:he({size:n,className:t}),children:s}):null}R.displayName="FieldErrorText";var we=tv({variants:{size:{sm:"text-[11px] mt-0.5",md:"text-[13px] mt-0.5",lg:"text-[13px] mt-1"}}});function E({size:o,as:s="div",children:n,className:t}){let u=s;return n?jsx(u,{className:we({size:o,className:t}),children:n}):null}E.displayName="FieldHelperText";var Ce=tv({base:"somaui-input-clear-btn input-clear-btn inline-flex shrink-0 transform items-center justify-center rounded-full bg-muted/70 backdrop-blur text-foreground/90 transition-all duration-200 ease-in-out hover:bg-primary hover:text-primary-foreground",variants:{size:{sm:"h-3.5 w-3.5",md:"h-4 w-4",lg:"h-4 w-4"},hasSuffix:{true:""}},compoundVariants:[{hasSuffix:true,size:"sm",class:"me-1.5"},{hasSuffix:true,size:"md",class:"me-2"},{hasSuffix:true,size:"lg",class:"me-2.5"}]});function $({as:o,size:s,onClick:n,hasSuffix:t,className:u}){return jsx(o||"button",{type:"button",onClick:n,"aria-label":"Clear input",className:Ce({size:s,hasSuffix:t,className:u}),children:jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:"h-4 w-auto","aria-hidden":"true",children:jsx("path",{d:"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z"})})})}$.displayName="FieldClearButton";var Y={normal:"font-normal",medium:"font-medium",semibold:"font-semibold",bold:"font-bold"};var N={weight:Y,size:{sm:"text-xs mb-1",md:"text-sm mb-1.5",lg:"text-sm mb-1.5"}};var Ee=tv({slots:{container:"flex items-center peer w-full transition duration-200 rounded-[var(--border-radius)] border-[length:var(--border-width)]",input:"w-full border-0 bg-transparent p-0 focus:outline-none focus:ring-0",button:"[&::file-selector-button]:inline-flex [&::file-selector-button]:font-medium [&::file-selector-button]:leading-none [&::file-selector-button]:items-center [&::file-selector-button]:justify-center [&::file-selector-button]:border-0 [&::file-selector-button]:focus-visible:ring-2 [&::file-selector-button]:focus-visible:ring-opacity-50 [&::file-selector-button]:bg-primary [&::file-selector-button]:hover:enabled:bg-primary-dark [&::file-selector-button]:focus-visible:ring-primary/30 [&::file-selector-button]:text-primary-foreground [&::file-selector-button]:rounded-[calc(var(--border-radius)-2px)]"},variants:{variant:{outline:{container:"bg-transparent focus-within::ring-[0.8px] ring-border border-border [&_input::placeholder]:text-gray-500 hover:border-primary focus-within::border-primary focus-within::ring-primary"},text:{container:"border-0 focus-within::ring-2 bg-transparent [&_input::placeholder]:opacity-70 hover:text-primary-dark focus-within::ring-primary/30 text-primary"}},size:{sm:{container:"pr-2 py-1 text-xs h-8 pl-[1px]",button:"[&::file-selector-button]:h-7 [&::file-selector-button]:px-2.5"},md:{container:"pr-3.5 py-2 text-sm h-10 pl-[1px]",button:"[&::file-selector-button]:h-9 [&::file-selector-button]:px-3.5"},lg:{container:"pr-4 py-2 text-base h-12 pl-[1px]",button:"[&::file-selector-button]:h-11 [&::file-selector-button]:px-4"}},disabled:{true:{container:"!bg-muted/70 backdrop-blur cursor-not-allowed !border-muted !text-muted-foreground",input:"cursor-not-allowed placeholder:text-muted-foreground",button:"[&::file-selector-button]:bg-muted-foreground [&::file-selector-button]:text-foreground [&::file-selector-button]:dark:text-muted"}},error:{true:{container:"!border-red hover:!border-red focus:!border-red !ring-red"}},clearable:{true:{input:"[&:placeholder-shown~.input-clear-btn]:opacity-0 [&:placeholder-shown~.input-clear-btn]:invisible [&:not(:placeholder-shown)~.input-clear-btn]:opacity-100 [&:not(:placeholder-shown)~.input-clear-btn]:visible"}}},defaultVariants:{variant:"outline",size:"md"}});function Fe({className:o,variant:s="outline",size:n="md",disabled:t,placeholder:u,label:w,labelWeight:v="medium",error:d,clearable:D,onClear:L,readOnly:A,helperText:H,labelClassName:Z,inputClassName:B,errorClassName:T,helperClassName:h,ref:S,...C}){let c=useCallback(P=>{P.preventDefault(),L&&L(P);},[L]),{container:m,input:x,button:V}=Ee({variant:s,size:n,disabled:t,error:!!d,clearable:D});return jsxs("div",{className:l("somaui-file-input-root","flex flex-col",o),children:[jsxs("label",{className:"block",children:[w?jsx("span",{className:l("somaui-file-input-label","block",N.size[n],N.weight[v],t&&"text-muted-foreground",Z),children:w}):null,jsxs("span",{className:m({className:B}),children:[jsx("input",{ref:S,type:"file",disabled:t,readOnly:A,spellCheck:"false","aria-invalid":d?"true":void 0,"aria-required":C.required,className:l(x(),V()),style:{fontSize:"inherit"},...C}),D&&jsx($,{size:n,onClick:c})]})]}),!d&&H?jsx(E,{size:n,className:l("somaui-file-input-helper-text",t&&"text-muted-foreground",h),children:H}):null,d?jsx(R,{size:n,error:d,className:l("somaui-file-input-error-text",T)}):null]})}var Me="Drag & drop files here or click to browse",Ie=({className:o})=>jsx("svg",{className:o,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),Ae=({className:o})=>jsx("svg",{className:o,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),Ze=({className:o})=>jsx("svg",{className:o,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})});function Be({file:o,className:s}){let[n,t]=useState("");return useEffect(()=>{let u=URL.createObjectURL(o);return t(u),()=>{URL.revokeObjectURL(u);}},[o]),n?jsx("img",{src:n,alt:o.name,className:s}):null}var Se=tv({slots:{root:"flex flex-col",uploadZoneArea:"relative flex flex-col items-center justify-center border-2 border-dashed rounded-[var(--border-radius)] transition-all duration-200 cursor-pointer",input:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",content:"flex flex-col items-center justify-center text-center pointer-events-none relative z-0",icon:"mb-2",text:"text-sm",previewContainer:"mt-4 space-y-2",previewGrid:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",previewItem:"relative group rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700",previewImage:"w-full h-full object-cover",previewRemoveButton:"absolute top-2 right-2 bg-red text-white rounded-full p-1.5 opacity-0 group-hover:opacity-100 transition-opacity shadow-lg hover:bg-red-dark cursor-pointer"},variants:{variant:{outline:{uploadZoneArea:"bg-transparent border-border hover:border-primary hover:bg-muted/30 focus-visible:border-primary focus-visible:bg-muted/30 focus-visible:outline-none"},flat:{uploadZoneArea:"bg-muted/30 backdrop-blur border-border hover:border-primary hover:bg-muted/50 focus-visible:border-primary focus-visible:bg-muted/50 focus-visible:outline-none"}},size:{sm:{uploadZoneArea:"p-6 min-h-[120px]",text:"text-xs",icon:"mb-1.5"},md:{uploadZoneArea:"p-8 min-h-[160px]",text:"text-sm",icon:"mb-2"},lg:{uploadZoneArea:"p-12 min-h-[200px]",text:"text-base",icon:"mb-3"}},isDragging:{true:{uploadZoneArea:"border-primary bg-primary/5 dark:bg-primary/10 scale-[1.02]"}},disabled:{true:{uploadZoneArea:"!bg-muted/70 backdrop-blur cursor-not-allowed !border-muted opacity-60",input:"cursor-not-allowed"}},error:{true:{uploadZoneArea:"!border-red hover:!border-red focus-visible:!border-red focus-visible:outline-none"}}},defaultVariants:{variant:"outline",size:"md"}});function Ve({className:o,variant:s="outline",size:n="md",disabled:t,label:u,labelWeight:w="medium",error:v,helperText:d,labelClassName:D,uploadZoneClassName:L,contentClassName:A,helperClassName:H,errorClassName:Z,previewClassName:B,multiple:T,accept:h,placeholder:S,icon:C,value:c,onChange:m,onDrop:x,name:V,ref:P,...K}){let U=useRef(null),[G,W]=useState(false),[Ue,O]=useState(0),[J,y]=useState([]);useImperativeHandle(P,()=>U.current,[]),useEffect(()=>{c!==void 0&&(c===null?y([]):c instanceof FileList?y(Array.from(c)):Array.isArray(c)&&y(c));},[c]);let Q=useCallback(e=>{let a=e instanceof FileList?Array.from(e):e;if(T)y(i=>{let p=[...i,...a],f=new DataTransfer;return p.forEach(b=>f.items.add(b)),m?.(f.files),p});else {y(a);let i=new DataTransfer;a.forEach(p=>i.items.add(p)),m?.(i.files);}},[T,m]),k=useCallback(e=>{e&&e.length>0&&(Q(e),x?.(e));},[Q,x]),te=useCallback(e=>{e.target.files&&e.target.files.length>0&&k(e.target.files),e.target.value="";},[k]),re=useCallback(e=>{y(a=>{let i=a.filter((f,b)=>b!==e);if(i.length===0)return m?.(null),[];let p=new DataTransfer;return i.forEach(f=>p.items.add(f)),m?.(p.files),i});},[m]),oe=useCallback(e=>{e.preventDefault(),e.stopPropagation(),!t&&(O(a=>a+1),e.dataTransfer.items&&e.dataTransfer.items.length>0&&W(true));},[t]),ae=useCallback(e=>{e.preventDefault(),e.stopPropagation(),!t&&O(a=>{let i=a-1;return i===0&&W(false),i});},[t]),ne=useCallback(e=>{e.preventDefault(),e.stopPropagation();},[]),M=useMemo(()=>h?h.split(",").map(e=>e.trim()):null,[h]),ie=useCallback(e=>{if(e.preventDefault(),e.stopPropagation(),t)return;W(false),O(0);let a=e.dataTransfer.files;if(a&&a.length>0)if(M&&M.length>0){let i=Array.from(a).filter(b=>M.some(j=>j.startsWith(".")?b.name.toLowerCase().endsWith(j.toLowerCase()):b.type.match(j.replace("*",".*"))));if(i.length===0)return;let p=new DataTransfer;i.forEach(b=>p.items.add(b));let f=p.files;k(f),x?.(f);}else k(a),x?.(a);},[t,M,k,x]),{root:le,uploadZoneArea:se,input:ue,content:pe,icon:X,text:ce,previewContainer:de,previewGrid:me,previewItem:fe,previewImage:be,previewRemoveButton:ge}=Se({variant:s,size:n,isDragging:G,disabled:t,error:!!v});return jsxs("div",{className:l(le(),o),children:[u?jsx("span",{className:l("somaui-upload-zone-label","block",N.size[n],N.weight[w],t&&"text-muted-foreground",D),children:u}):null,jsxs("div",{className:se({className:L}),onDragEnter:oe,onDragOver:ne,onDragLeave:ae,onDrop:ie,onClick:e=>{let a=e.target;t||a.closest(".somaui-upload-zone-preview-item")||a.closest("button");},role:"button",tabIndex:t?-1:0,"aria-disabled":t,onKeyDown:e=>{(e.key==="Enter"||e.key===" ")&&!t&&(e.preventDefault(),U.current?.click());},children:[jsx("input",{ref:U,type:"file",name:V,className:ue(),disabled:t,multiple:T,accept:h,onChange:te,"aria-invalid":v?"true":void 0,"aria-required":K.required,...K}),jsxs("div",{className:l(pe(),A),children:[C!==null&&jsx("div",{className:X(),children:C||jsx(Ie,{className:l("h-8 w-8 text-gray-400 dark:text-gray-500",X())})}),jsx("p",{className:l(ce(),"text-gray-600 dark:text-gray-400",G&&"text-primary"),children:S||Me})]})]}),!v&&d?jsx(E,{size:n,className:l("somaui-upload-zone-helper-text",t&&"text-muted-foreground",H),children:d}):null,J.length>0&&jsx("div",{className:l(de(),B),children:jsx("div",{className:me(),children:J.map((e,a)=>{let i=`${e.name}-${e.size}-${e.lastModified}-${a}`;return jsxs("div",{className:l(fe(),"somaui-upload-zone-preview-item"),children:[e.type.startsWith("image/")?jsx("div",{className:"aspect-square",children:jsx(Be,{file:e,className:be()})}):jsx("div",{title:e.name,className:"flex aspect-square items-center justify-center",children:jsx("div",{className:"p-4 text-center",children:jsx(Ae,{className:"mx-auto mb-2 h-12 w-12 text-gray-400"})})}),jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),re(a);},className:ge(),"aria-label":`Remove ${e.name}`,children:jsx(Ze,{className:"h-4 w-4"})}),jsx("div",{className:"absolute right-0 bottom-0 left-0 truncate bg-black/70 px-2 py-1 text-xs text-white",children:e.name}),jsxs("div",{className:"absolute top-2 left-2 rounded bg-black/70 px-2 py-1 text-xs text-white",children:[(e.size/1024).toFixed(1)," KB"]})]},i)})})}),v?jsx(R,{size:n,error:v,className:l("somaui-upload-zone-error-text",Z)}):null]})}
export{Fe as FileInput,Ve as UploadZone};